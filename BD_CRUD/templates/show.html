{% extends "base.html" %}

{% block title %} Contenido de {{ params.titulo }} {% endblock %}

{% block titular %} Contenido de {{ params.titulo }} {% endblock %}

{% block head%}

<script>

$(document).ready(function(){ // espera que se carge la página para ejecutarse
        $("#btn_insert").bind("click", haz_submit);
        $("#btn_insert").bind("mouseover", cambia_cursor);
        $("img").bind("mouseover", cambia_cursor);
        $("img[id^='add_controles']").bind("click", remove_campo);
        $("input").bind("click", registra_cambios);
});

    function registra_cambios(e){
        // subimos 2 niveles desde donde estamos para coger el id del contenedor
        padre = $(this).parent().parent().attr('id');
        console.log(padre);
        elementos = "";
        $("#"+padre).find(":text").each(function(){
                    //console.log( $(this).attr('id') + " : " + $(this).val() );
                    elementos += $(this).val() + ",";
        });
        console.log(elementos);
/*
        padre_bueno = document.getElementById(padre).children;
        lista_valores = "[";

        $(padre_bueno).each(
            function(){
                elemento = $(this).find("input").val();
                lista_valores += elemento + ",";
            }
        );
        lista_valores = lista_valores.slice(0, -1);
        lista_valores += "]";
        console.log(lista_valores);
*/
    }

    function haz_submit(){
        document.getElementById("form_insercion").submit();

        /*
        sql = "insert into {{ params.titulo }} values(";
        elements = document.getElementById("form_insercion").elements;

        for (i=0; i<elements.length; i++){
            sql += elements[i].value + ", ";
        }

        // quitamos la última coma añadida por el bucle
        resultado = sql.slice(0, -2);
        console.log(resultado+")");

        return false;
        */
    }

    function remove_campo(){
        return false;
    }

    function cambia_cursor(e){
        $(this).css("cursor", "pointer");
    }


</script>

{% endblock %}

{% block body %}

<table border=0>
    <tr>
    {% for filas in columnas: %}
        <!-- comprueba si es la última vuelta del bucle-->
        {% if loop.last %}

            {% for celdas in filas %}
                    <th colspan="2">{{ celdas }}</th>
            {% endfor %}

        {% else %}

            {% for celdas in filas %}
                <th colspan="1">{{ celdas }}</th>
            {% endfor %}

        {% endif %}

    {% endfor %}
    </tr>

    {% for fila in registros: %}
        <tr id="add_controles_{{ loop.index }}">
            {% for celda in fila %}
            <td id="td_{{loop.index}}"><input id="campo_{{ loop.index }}" type="text" size="5" value="{{ celda }}"></td>
            {% endfor %}
        <td id="remove"><img src="../static/images/field_remove.png" width='40'" id="img"></td></tr>
    {% endfor %}
    </table>

    <table border=0>
    <tr><td colspan="{{ columnas|length +1 }}">
        <img src="../static/images/separador2.png" class="strech">
    </td></tr>

        <form
            name="form_insercion"
            id ="form_insercion"
            action="{{ url_for('insert') }}"
            method="POST"
        >
        <input type="hidden" name="tabla" id="tabla" value="{{ params.titulo }}">
        <!-- <input type="hidden" name="pk" value="{{ pk }}"> -->

    <tr>

<!-- forma de acceder a las propiedades de un objeto-->
{% for i in range(columnas|length): %}

    {% if loop.last %}
        <td><input type="text" size="5" name="campo_{{i}}" id="campo_{{i}}"></td>
        <td><img id="btn_insert" src="../static/images/field_add.png" width="40"></td>
    {% else %}
        <td><input type="text" size="5" name="campo_{{i}}" id="campo_{{i}}"></td>
    {% endif %}

{% endfor %}
    </tr></table>
</from>

{% endblock %}